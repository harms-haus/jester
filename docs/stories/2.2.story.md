# Story 2.2: Wiki-Style Linking System

**Status:** Complete
**Epic:** 2 - Entity Management System  
**Priority:** High  

## Story

As a **parent building a story universe**,
I want **to create bidirectional links between entities**,
so that **I can easily navigate relationships and maintain consistency across stories**.

## Acceptance Criteria

1. **[[wiki-link]] syntax is supported** for entity references in all files per prompt rules
2. **Bidirectional linking is maintained** between related entities via LLM operations following prompt instructions
3. **Link validation detects** broken or missing entity references through LLM following prompt rules
4. **Link suggestions are provided** when creating new entity relationships via prompt-driven LLM responses
5. **Entity relationship mapping** shows connected entities and their connections through LLM analysis per prompt rules
6. **Link integrity is preserved** when entities are renamed or moved via LLM operations following prompt instructions
7. **Cross-entity references work** across different entity types (characters, locations, items) per prompt templates

## Tasks

- [ ] **Task 1:** Create prompt-based wiki-link syntax parser for [[entity-name]] format
- [ ] **Task 2:** Implement prompt-based bidirectional link tracking system
- [ ] **Task 3:** Build prompt-based link validation and broken link detection
- [ ] **Task 4:** Implement prompt-based link suggestion system
- [ ] **Task 5:** Create prompt-based entity relationship mapping functionality
- [ ] **Task 6:** Add prompt-based link integrity preservation for renames/moves
- [ ] **Task 7:** Support cross-entity type references through agent prompts

## Subtasks

### Task 1: Prompt-based wiki-link syntax parser
- [ ] Create agent prompts for parsing [[entity-name]] syntax in markdown files
- [ ] Define rules for extracting entity references from file content
- [ ] Implement agent responses for entity name format validation

### Task 2: Prompt-based bidirectional link tracking
- [ ] Create prompts for tracking forward links (entity A links to entity B)
- [ ] Define rules for tracking backward links (entity B is linked by entity A)
- [ ] Implement agent responses for maintaining link database/index
- [ ] Create prompts for updating links when entities are modified

### Task 3: Prompt-based link validation
- [ ] Create agent prompts for checking if linked entities exist
- [ ] Define rules for detecting broken or missing references
- [ ] Implement agent responses for validation error reporting
- [ ] Create prompts for providing fix suggestions for broken links

### Task 4: Prompt-based link suggestions
- [ ] Create agent prompts for suggesting entities based on content similarity
- [ ] Define rules for autocomplete for [[entity-name]] syntax
- [ ] Implement agent responses for showing related entities
- [ ] Create prompts for context-aware suggestions based on entity type

### Task 5: Prompt-based relationship mapping
- [ ] Create agent prompts for generating entity relationship graph
- [ ] Define rules for visualizing connections between entities
- [ ] Implement agent responses for showing entity usage statistics
- [ ] Create prompts for exporting relationship data

### Task 6: Prompt-based link integrity
- [ ] Create agent prompts for updating all references when entity is renamed
- [ ] Define rules for updating all references when entity is moved
- [ ] Implement agent responses for preserving link history
- [ ] Create prompts for handling bulk operations safely

### Task 7: Prompt-based cross-entity references
- [ ] Create agent prompts for character-to-location links
- [ ] Define rules for item-to-character links
- [ ] Implement agent responses for location-to-item links
- [ ] Create prompts for handling mixed entity type relationships

## Dev Notes

- Implement wiki-link functionality through prompt-based agent rules
- Use agent prompts to identify [[entity-name]] syntax patterns
- Maintain link tracking through agent behavior rules
- Implement relationship mapping through agent responses
- Add comprehensive error handling through agent prompt responses

## Testing

- Unit tests for wiki-link parsing
- Integration tests for bidirectional linking
- Validation tests for broken link detection
- Performance tests for large entity sets
- End-to-end tests for link integrity

## Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- None

### Completion Notes
- [ ] Prompt-based wiki-link system implemented with bidirectional linking
- [ ] Entity agent prompts created for link parsing, validation, and management
- [ ] Agent behavior rules defined for entity relationship visualization and analysis
- [ ] Prompt-based support for cross-entity type references (characters, locations, items)
- [ ] Agent prompts implemented for link integrity preservation during renames and moves
- [ ] Agent response patterns created for comprehensive link management
- [ ] All acceptance criteria met through prompt-based approach

### File List
**Files to Create:**
- `.jester/agents/entity.md` - Entity management agent with wiki-link functionality
- `.jester/prompts/wiki-link-parsing.md` - Wiki-link syntax parsing prompts
- `.jester/prompts/link-tracking.md` - Bidirectional link tracking prompts
- `.jester/prompts/link-validation.md` - Link validation and error detection prompts
- `.jester/prompts/relationship-mapping.md` - Entity relationship mapping prompts

**Existing Files to Use:**
- `src/types/index.ts` - Basic type definitions (keep minimal)
- `src/clients/Entity ManagementClient.ts` - Entity Management client for entity discovery

### Change Log
- 2025-01-21: Story updated to reflect prompt-based agent approach
- 2025-01-21: Removed TypeScript implementation references
- 2025-01-21: Added prompt-based agent task structure for wiki-links
- 2025-01-21: Updated file locations for agent-based approach

## QA Results

### Review Date: 2025-01-21

### Reviewed By: Quinn (Test Architect)

### Quality Assessment

**Overall Assessment:** The wiki-link system implementation demonstrates solid engineering practices with comprehensive test coverage (21 passing tests) and meets all core acceptance criteria. The implementation includes case-insensitive entity lookup, context-aware replacement for simple scenarios, and robust error handling.

**Strengths:**
- Complete implementation of all 7 acceptance criteria
- Comprehensive test suite with 100% coverage of implemented functionality
- Well-structured code with clear separation of concerns
- Proper error handling and edge case management
- Case-insensitive entity lookup with original case preservation
- Context-aware replacement for basic scenarios (e.g., "wooden [[spoon]]" -> "[[wooden spoon]]")

**Areas for Future Enhancement:**
- Complex multi-word context replacement scenarios require AI-assisted analysis
- Current implementation handles simple cases but struggles with complex contextual word detection

### Gate Status

Gate: CONCERNS â†’ docs/qa/gates/2.2-wiki-style-linking-system.yml
