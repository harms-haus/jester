# Story 3.3: Prompt Rules Reorganization

## Story Information
- **Epic**: 3 - LightRAG Integration
- **Story Number**: 3.3
- **Status**: Ready for Development
- **Created**: 2025-01-27
- **Last Modified**: 2025-01-27

## Story Statement

As a **parent using jester**,
I want **a single entry point that guides me through available workflows**,
so that **I can easily start new projects, continue existing work, or manage my story universe without learning multiple agent commands**.

## Acceptance Criteria

1. **Unified Entry Point** provides @jester command with workflow selection menu
2. **Workflow Selection** offers clear options: new project, continue draft, universe management
3. **Domain Organization** groups related functionality into logical domains
4. **Backward Compatibility** maintains existing agent functionality during transition
5. **Documentation Updates** reflect new structure in all relevant artifacts

## Tasks / Subtasks

- [x] Task 1: Create @jester Entry Point (AC: 1, 2)
  - [x] 1.1. Create main @jester agent file with workflow selection
  - [x] 1.2. Implement user greeting and workflow options
  - [x] 1.3. Add dynamic file loading based on user selection

- [x] Task 2: Reorganize Agent Structure (AC: 3)
  - [x] 2.1. Create publishing domain group (muse, write agents)
  - [x] 2.2. Create editing domain group (edit agent + editing prompts)
  - [x] 2.3. Create entity management domain group (entity agent + entity prompts)
  - [x] 2.4. Create validation domain group (validation prompts)

- [x] Task 3: Update Documentation (AC: 5)
  - [x] 3.1. Update PRD functional requirements
  - [x] 3.2. Update architecture documents
  - [x] 3.3. Update workflow management references

- [x] Task 4: Ensure Backward Compatibility (AC: 4)
  - [x] 4.1. Maintain existing agent files during transition
  - [x] 4.2. Add deprecation notices to old agent files
  - [x] 4.3. Test existing workflows still function

## Dev Notes

### Previous Story Insights
From Stories 3.1 and 3.2, the system has established LightRAG integration capabilities. This story focuses on improving the user experience and maintainability of the prompt rules system without changing core functionality.

### Reorganization Requirements
This story implements a major architectural improvement to the prompt rules system:
- **Single Entry Point**: @jester command provides unified access to all workflows
- **Domain Organization**: Group related functionality into logical domains
- **Workflow Selection**: Guide users to appropriate specialized agents
- **Maintainability**: Reduce rule duplication and improve organization

### Data Models
No changes to existing data models. This is purely an organizational improvement to the prompt rules system.

### API Specifications
No changes to LightRAG integration or MCP client functionality. This story focuses on prompt rules organization only.

### Component Specifications
**New Component**: Entry Point Management
- **Purpose**: Provides unified workflow selection and user guidance
- **Technology**: Markdown prompt rule file following BMAD pattern
- **Key Features**: User greeting, workflow selection, dynamic agent loading
- **Dependencies**: All existing agent files, workflow selection prompts

### File Locations
**New Files**:
- `.jester/agents/jester.md` - Main entry point agent
- `.jester/prompts/workflow-selection.md` - Workflow selection logic
- `.jester/prompts/user-greeting.md` - User greeting and guidance
- `.jester/templates/workflow-menu.yaml` - Workflow selection template

**Modified Files**:
- All existing agent files (add deprecation notices)
- `.jester/prompts/workflow-management.md` - Update command references
- `docs/prd.md` - Update functional requirements
- `docs/architecture/components.md` - Update agent system description

### Technical Constraints
**Dependencies**: No new dependencies required. This is purely a prompt rules reorganization.

**Performance Considerations**: 
- Dynamic file loading based on user selection
- Maintain existing agent performance characteristics
- No impact on LightRAG integration performance

**Architectural Patterns**:
- Maintain existing Agent-Based Architecture
- Preserve File-Based Pipeline pattern
- Keep Local-First Storage approach
- Maintain Knowledge Graph Integration

### Testing Requirements
Following general coding standards:
- Test all existing workflows still function
- Validate new entry point works correctly
- Ensure backward compatibility
- Test workflow selection logic

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-27 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (via Cursor IDE)

### Debug Log References
- No debug log references for this implementation

### Completion Notes List
- **Task 1**: Successfully created @jester main entry point with workflow selection, user greeting prompts, project initialization prompts, and workflow menu template
- **Task 2**: Successfully reorganized agent structure into domain groups (publishing, editing, entity-management, validation) with proper file organization
- **Task 3**: All documentation updates completed by Product Owner (PRD, architecture, workflow management)
- **Task 4**: Backward compatibility ensured with deprecation notices and maintained file access
- **Integration**: @jester entry point properly configured to access all domain-specific agents and prompts
- **Testing**: All existing workflows remain functional with new domain organization
- **Bug Fix**: Fixed entity creation issue during context generation - entities should only be suggested, not created, during context gathering phase

### File List
**New Files Created:**
- `docs/stories/3.3.story.md` - Epic 3.3 story definition
- `.jester/agents/jester.md` - Main entry point agent
- `.jester/prompts/workflow-selection.md` - Workflow selection logic
- `.jester/prompts/user-greeting.md` - User greeting and guidance prompts
- `.jester/prompts/project-initialization.md` - Project setup and continuation prompts
- `.jester/templates/workflow-menu.yaml` - Workflow selection template
- `.jester/agents/domains/publishing/muse.md` - Publishing domain muse agent
- `.jester/agents/domains/publishing/write.md` - Publishing domain write agent
- `.jester/agents/domains/editing/edit.md` - Editing domain edit agent
- `.jester/agents/domains/entity-management/entity.md` - Entity management domain entity agent
- `.jester/prompts/domains/publishing/` - Publishing domain prompts (5 files)
- `.jester/prompts/domains/editing/` - Editing domain prompts (2 files)
- `.jester/prompts/domains/entity-management/` - Entity management domain prompts (2 files)
- `.jester/prompts/domains/validation/` - Validation domain prompts (5 files)

**Modified Files:**
- `.jester/agents/muse.md` - Added deprecation notice
- `.jester/agents/write.md` - Added deprecation notice
- `.jester/agents/edit.md` - Added deprecation notice
- `.jester/agents/entity.md` - Added deprecation notice
- `docs/prd.md` - Updated functional requirements (by PO)
- `docs/architecture/components.md` - Updated agent system description (by PO)
- `.jester/prompts/workflow-management.md` - Updated command references (by PO)

## QA Results

*Results from QA Agent review will be populated here*
