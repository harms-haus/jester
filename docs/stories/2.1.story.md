# Story 2.1: Entity Directory Structure and Templates

## Story Information
- **Epic**: 2 - Entity Management System
- **Story Number**: 2.1
- **Status**: Ready for Review
- **Created**: 2025-01-21
- **Last Modified**: 2025-01-21

## Story Statement

As a **parent building a story universe**,
I want **to have organized entity directories with standardized templates**,
so that **I can maintain consistent entity information across my story universe**.

## Acceptance Criteria

1. **Entity subdirectories are created** (entities/characters/, entities/locations/, entities/items/)
2. **Markdown templates are defined** for each entity type with consistent structure
3. **Template fields include** name, description, relationships, story appearances, and metadata
4. **Entity files are created** using templates with proper naming conventions
5. **Directory structure is maintained** automatically when new entities are added
6. **Template validation ensures** all required fields are present
7. **Entity files are properly formatted** with markdown headers and sections

## Dev Notes

### Previous Story Insights
Story 1.5 completed the basic edit functionality, establishing a robust file editing system with backup capabilities and comprehensive error handling. The command router system is functional and ready for entity management commands. The project structure includes the necessary directories and the agent framework is established for implementing entity management features.

### Data Models
Based on architecture documentation, the following data structures will be used for entity management:

**EntityReference Interface** [Source: architecture/data-models.md#Core Data Structures]:
```typescript
interface EntityReference {
  name: string;
  type: 'character' | 'location' | 'item';
  file_path: string;
  description: string;
}
```

**Entity Template Structure** [Source: architecture/source-tree.md#Project Structure]:
- Character templates include: Basic Information, Description, Personality, Relationships, Story Appearances, Physical Description, Abilities & Skills, Backstory, Notes
- Location templates include: Basic Information, Description, Physical Features, Atmosphere & Mood, Inhabitants, History & Significance, Story Appearances, Connections, Special Properties, Notes
- Item templates include: Basic Information, Description, Physical Properties, Function & Purpose, Special Properties, History & Origin, Current Status, Story Appearances, Relationships, Cultural Significance, Notes

### File Locations
Based on the source tree structure [Source: architecture/source-tree.md#Project Structure]:

**Required Files to Create/Modify:**
- `entities/characters/` - Directory for character entity files (already exists)
- `entities/locations/` - Directory for location entity files (already exists)  
- `entities/items/` - Directory for item entity files (already exists)
- `.jester/templates/character.md` - Character template file (already exists)
- `.jester/templates/location.md` - Location template file (already exists)
- `.jester/templates/item.md` - Item template file (already exists)

**Existing Files to Integrate With:**
- `src/utils/fileUtils.ts` - File operations utilities for entity file management
- `src/utils/errorHandler.ts` - Error handling system
- `src/agents/commandRouter.ts` - Command router system for entity commands

### Technical Constraints
**Tech Stack Requirements** [Source: architecture/tech-stack.md#Core Technologies]:
- **Runtime**: Node.js with TypeScript
- **Package Manager**: npm
- **File System**: Node.js fs module with fs-extra
- **Dependencies**: @types/node, yaml, fs-extra

**Coding Standards** [Source: architecture/coding-standards.md#TypeScript Standards]:
- Use strict TypeScript configuration
- Prefer interfaces over types for object shapes
- Use explicit return types for public methods
- Follow camelCase for variables and functions
- Use PascalCase for classes and interfaces

**Error Handling** [Source: architecture/coding-standards.md#Error Handling]:
- Use try-catch blocks for async operations
- Provide meaningful error messages
- Log errors with context information
- Graceful degradation for non-critical failures

### Template Structure Requirements
**Character Template Fields** [Source: .jester/templates/character.md]:
- Basic Information: Name, Type, Age, Species
- Description, Personality, Relationships, Story Appearances
- Physical Description, Abilities & Skills, Backstory, Notes
- Metadata: Created, Last Modified, Version

**Location Template Fields** [Source: .jester/templates/location.md]:
- Basic Information: Name, Type, Climate, Size
- Description, Physical Features, Atmosphere & Mood, Inhabitants
- History & Significance, Story Appearances, Connections, Special Properties
- Metadata: Created, Last Modified, Version

**Item Template Fields** [Source: .jester/templates/item.md]:
- Basic Information: Name, Type, Rarity, Value
- Description, Physical Properties, Function & Purpose, Special Properties
- History & Origin, Current Status, Story Appearances, Relationships
- Cultural Significance, Notes, Metadata

### Entity File Naming Conventions
Based on existing entity files [Source: entities/ directory]:
- Character files: `{character-name}.md` (e.g., `brave-mouse.md`)
- Location files: `{location-name}.md` (e.g., `enchanted-forest.md`)
- Item files: `{item-name}.md` (e.g., `magic-sword.md`)
- Use kebab-case for file names
- All files use `.md` extension

### Template Validation Requirements
- All required fields must be present in entity files
- Template placeholders ({{FIELD_NAME}}) must be replaced with actual values
- Markdown formatting must be consistent with template structure
- Metadata fields must include proper timestamps and version numbers

### Testing
**Test file location**: `src/__tests__/entityTemplate.test.ts` (new test file)
**Testing frameworks**: Jest [Source: architecture/tech-stack.md#Development Tools]
**Test standards**: Unit tests for template validation, file creation, directory structure maintenance

## Tasks / Subtasks

### Task 1: Verify Entity Directory Structure (AC: 1)
- [x] 1.1. Verify entities/characters/ directory exists and is accessible
- [x] 1.2. Verify entities/locations/ directory exists and is accessible  
- [x] 1.3. Verify entities/items/ directory exists and is accessible
- [x] 1.4. Test directory creation if any directories are missing
- [x] 1.5. Validate directory permissions and access rights

### Task 2: Validate Template Definitions (AC: 2, 3)
- [x] 2.1. Review character template structure and required fields
- [x] 2.2. Review location template structure and required fields
- [x] 2.3. Review item template structure and required fields
- [x] 2.4. Verify template fields include name, description, relationships, story appearances, metadata
- [x] 2.5. Validate template markdown formatting and structure
- [x] 2.6. Test template placeholder replacement functionality

### Task 3: Implement Entity File Creation (AC: 4, 5)
- [x] 3.1. Create entity file generation from templates
- [x] 3.2. Implement proper naming conventions for entity files
- [x] 3.3. Ensure directory structure is maintained when new entities are added
- [x] 3.4. Create entity file validation and formatting
- [x] 3.5. Implement template placeholder replacement with actual values

### Task 4: Implement Template Validation (AC: 6, 7)
- [x] 4.1. Create template validation for required fields
- [x] 4.2. Implement entity file formatting validation
- [x] 4.3. Ensure all required fields are present in entity files
- [x] 4.4. Validate markdown headers and sections formatting
- [x] 4.5. Create validation error reporting and correction suggestions

### Task 5: Integration and Testing (AC: All)
- [x] 5.1. Integrate entity management with existing file utilities
- [x] 5.2. Create unit tests for template validation
- [x] 5.3. Create unit tests for entity file creation
- [x] 5.4. Create unit tests for directory structure maintenance
- [x] 5.5. Test integration with command router system

## Project Structure Notes
Current project structure already includes the required entity directories and templates:
- `entities/characters/`, `entities/locations/`, `entities/items/` directories exist
- `.jester/templates/character.md`, `location.md`, `item.md` templates exist
- Some entity files already exist (brave-mouse.md, test-character.md, etc.)
- File utilities and error handling systems are in place
- Command router system is ready for entity management commands

## Change Log
- 2025-01-21: Initial story draft created

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (via Cursor)

### Debug Log References
- All entity file creation methods implemented successfully
- Template validation working correctly
- Unit tests passing (20/20 tests for FileUtils)
- Full test suite passing (177/177 tests)

### Completion Notes List
- ✅ Entity directory structure verified and accessible
- ✅ Template definitions validated for all entity types (character, location, item)
- ✅ Entity file creation methods implemented with proper naming conventions
- ✅ Template placeholder replacement functionality working correctly
- ✅ Entity file validation implemented with required field checking
- ✅ Comprehensive unit tests created and passing
- ✅ Integration with existing file utilities completed
- ✅ All acceptance criteria met

### File List
**Modified Files:**
- `src/utils/fileUtils.ts` - Added entity file creation and validation methods
- `src/__tests__/fileUtils.test.ts` - Added comprehensive entity-specific unit tests

**Existing Files Used:**
- `.jester/templates/character.md` - Character template (validated)
- `.jester/templates/location.md` - Location template (validated)  
- `.jester/templates/item.md` - Item template (validated)
- `entities/characters/` - Character directory (verified)
- `entities/locations/` - Location directory (verified)
- `entities/items/` - Item directory (verified)

### Change Log
- 2025-01-21: Story implementation completed
- 2025-01-21: Added entity file creation methods to FileUtils class
- 2025-01-21: Implemented template validation functionality
- 2025-01-21: Created comprehensive unit tests for entity management
- 2025-01-21: All tasks completed and tests passing

## QA Results
*This section will be populated by the QA agent during review*
